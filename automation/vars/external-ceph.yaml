---
vas:
  external-ceph:
    stages:
      - path: examples/dt/external-ceph/control-plane/nncp
        validations:
          - >-
            oc -n openstack wait nncp
            -l osp/nncm-config-type=standard
            --for jsonpath='{.status.conditions[0].reason}'=SuccessfullyConfigured
            --timeout=60s
        values:
          - name: network-values
            src_file: values.yaml
        build_output: nncp.yaml

      - path: examples/dt/external-ceph/control-plane
        validations:
          - >-
            oc -n openstack wait osctlplane controlplane --for condition=Ready
            --timeout=600s
        values:
          - name: network-values
        build_output: ../control-plane.yaml

      - path: examples/dt/external-ceph/edpm-pre-ceph
        validations:
          - >-
            oc -n openstack wait
            osdpd ceph-deployment --for condition=Ready
            --timeout=1200s
        values:
          - name: ceph-values
            src_file: values.yaml
        build_output: dataplane-pre-ceph.yaml
        post_stage_run:
          - name: Deploy Ceph
            type: playbook
            source: "../../playbooks/ceph.yml"
            inventory: "${HOME}/reproducer-inventory/ceph-group.yml"

      - path: examples/dt/external-ceph
        validations:
          - >-
            oc -n openstack wait
            osdpd edpm-deployment-post-ceph --for condition=Ready
            --timeout=1200s
        values:
          - name: service-values
            src_file: service-values.yaml
          - name: edpm-values-post-ceph
            src_file: values.yaml
        build_output: dataplane-post-ceph.yaml
